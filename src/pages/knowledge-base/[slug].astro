---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('knowledge-base');

  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const { title, description, category, icon, image, lastUpdated } = article.data;
const { Content } = await article.render();
const baseUrl = import.meta.env.BASE_URL;

const categories = {
  'getting-started': 'Getting Started',
  'guides': 'Guides',
  'tutorials': 'Tutorials',
  'api-reference': 'API Reference',
  'faq': 'FAQ'
};
---

<BaseLayout
  title={title}
  description={description}
  image={image || undefined}
>
  <article class="section-padding">
    <div class="container mx-auto px-4 max-w-5xl">
      <div class="grid lg:grid-cols-4 gap-8">
        <!-- Sidebar -->
        <aside class="lg:col-span-1">
          <div class="sticky top-24">
            <div class="card bg-base-200">
              <div class="card-body">
                <h3 class="card-title text-sm">Article Info</h3>
                <div class="divider my-2"></div>
                <div class="space-y-3 text-sm">
                  <div>
                    <div class="text-base-content/60">Category</div>
                    <div class="font-medium flex items-center gap-2">
                      {icon}
                      {categories[category as keyof typeof categories]}
                    </div>
                  </div>
                  <div>
                    <div class="text-base-content/60">Last Updated</div>
                    <div class="font-medium">
                      {lastUpdated && new Date(lastUpdated).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                      })}
                    </div>
                  </div>
                </div>
                <div class="divider my-2"></div>
                <a href={`${baseUrl}knowledge-base`} class="btn btn-sm btn-outline btn-block">
                  ‚Üê All Articles
                </a>
              </div>
            </div>
          </div>
        </aside>

        <!-- Main Content -->
        <div class="lg:col-span-3">
          <header class="mb-12">
            <div class="breadcrumbs text-sm mb-6">
              <ul>
                <li><a href={baseUrl}>Home</a></li>
                <li><a href={`${baseUrl}knowledge-base`}>Knowledge Base</a></li>
                <li><a href={`${baseUrl}knowledge-base?category=${category}`}>{categories[category as keyof typeof categories]}</a></li>
                <li>{title}</li>
              </ul>
            </div>

            <div class="flex items-center gap-3 mb-4">
              <span class="text-5xl">{icon}</span>
              <h1 class="text-4xl md:text-5xl font-bold leading-tight">
                {title}
              </h1>
            </div>

            <p class="text-xl leading-relaxed text-base-content/80 mb-6">
              {description}
            </p>

            {image && (
              <div class="rounded-2xl overflow-hidden shadow-2xl mb-8">
                <img
                  src={image}
                  alt={title}
                  class="w-full h-auto"
                  loading="eager"
                />
              </div>
            )}
          </header>

          <div class="prose prose-lg max-w-none">
            <Content />
          </div>

          <!-- Feedback Section -->
          <div class="mt-16 pt-8 border-t border-base-300">
            <div class="card bg-base-200">
              <div class="card-body">
                <h3 class="card-title">Was this article helpful?</h3>
                <p class="text-base-content/70">Let us know how we can improve our documentation.</p>
                <div class="card-actions justify-start mt-4">
                  <button class="btn btn-success btn-sm gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/>
                    </svg>
                    Yes, helpful
                  </button>
                  <button class="btn btn-error btn-sm gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667v-5.43a2 2 0 00-1.105-1.79l-.05-.025A4 4 0 0011.055 2H5.64a2 2 0 00-1.962 1.608l-1.2 6A2 2 0 004.44 12H8v4a2 2 0 002 2 1 1 0 001-1v-.667a4 4 0 01.8-2.4l1.4-1.866a4 4 0 00.8-2.4z"/>
                    </svg>
                    No, needs work
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </article>
</BaseLayout>
