---
import { getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Hero from '@/components/ui/Hero.astro';
import PageSection from '@/components/PageSection.astro';

// Fetch page content from collection
const page = await getEntry('pages', 'pricing');

if (!page) {
  return Astro.redirect('/404');
}

const { title, description, hero, sections = [] } = page.data;
---

<BaseLayout
  title={title.charAt(0).toUpperCase() + title.slice(1)}
  description={description}
>
  <!-- Hero -->
  {hero && (
    <Hero
      title={hero.title}
      subtitle={hero.subtitle}
    />
  )}

  <!-- Dynamic Sections -->
  {sections.map((section, index) => {
    const className = index % 2 === 1 ? 'bg-base-200' : '';

    // Add comparison table after pricing section
    if (section.sectionType === 'pricing') {
      return (
        <>
          <PageSection
            section={section}
            className={className}
          />

          <!-- Comparison Table -->
          <section class="section-padding">
            <div class="container-custom">
              <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-4">Feature Comparison</h2>
                <p class="text-xl text-base-content/70">
                  Compare plans side-by-side to find the perfect fit
                </p>
              </div>

              <div class="overflow-x-auto">
                <table class="table table-zebra w-full max-w-5xl mx-auto">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th class="text-center">Starter</th>
                      <th class="text-center">Professional</th>
                      <th class="text-center">Enterprise</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Core Features</td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                    </tr>
                    <tr>
                      <td>Storage</td>
                      <td class="text-center">1 GB</td>
                      <td class="text-center">10 GB</td>
                      <td class="text-center">Unlimited</td>
                    </tr>
                    <tr>
                      <td>Custom Domain</td>
                      <td class="text-center">Basic</td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                    </tr>
                    <tr>
                      <td>Support</td>
                      <td class="text-center">Community</td>
                      <td class="text-center">Priority Email</td>
                      <td class="text-center">Dedicated + SLA</td>
                    </tr>
                    <tr>
                      <td>Analytics</td>
                      <td class="text-center">Basic</td>
                      <td class="text-center">Advanced</td>
                      <td class="text-center">Custom</td>
                    </tr>
                    <tr>
                      <td>Team Members</td>
                      <td class="text-center">1</td>
                      <td class="text-center">5</td>
                      <td class="text-center">Unlimited</td>
                    </tr>
                    <tr>
                      <td>White-label</td>
                      <td class="text-center">-</td>
                      <td class="text-center">-</td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                    </tr>
                    <tr>
                      <td>Custom Integrations</td>
                      <td class="text-center">-</td>
                      <td class="text-center">Limited</td>
                      <td class="text-center"><span class="text-success text-xl">✓</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        </>
      );
    }

    return (
      <PageSection
        section={section}
        className={className}
      />
    );
  })}
</BaseLayout>
